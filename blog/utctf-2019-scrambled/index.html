<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js integrity=sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4 crossorigin=anonymous></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;600;800&family=Open+Sans:wght@400;600&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/solid.min.css integrity="sha512-LopA1sokwAW/FNZdP+/5q8MGyb9CojL1LTz8JMyu/8YZ8XaCDn1EOm6L7RWIIOHRM7K4jwnHuOmyLZeeeYxSOA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/caseyhates.css><title>UTCTF 2019 - Scrambled | OSU Security Club</title></head><body id=background-img style=background-image:url(/blog/utctf-2019-scrambled.jpg);background-position:50%><nav class="navbar navbar-expand-lg px-lg-5 py-lg-2 fixed-top topbar bg-light"><div class="container-fluid flex-nowrap px-lg-5"><a class=navbar-brand href=/><img src=/osusec-banner.png class=img-fluid alt=OSUSEC width=450px></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul><ul class="navbar-nav d-flex mb-2 mb-lg-0"><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/>Home</a></li><li class="nav-item px-1 dropdown"><a class="nav-link text-black dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>About</a><ul class=dropdown-menu><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/about/>Who We Are</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/club-constitution/>Club Constitution</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/wicys/>WiCyS</a></li></ul></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/calendar/>Calendar</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/blog/>Blog</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/ctf-league/>CTF League</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/accomplishments/>Accomplishments</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/resources/>Resources</a></li></ul></div></div></nav><main id=main><div id=home-jumbotron class="jumbotron text-center hero-content infopage-hero d-flex flex-column justify-content-center"><h1 class="hero-title py-1">UTCTF 2019 - Scrambled</h1></div><div class="bg-light justify-content-center infopage-content" style=min-height:60vh><div class=blog-content><h1 class=blog-title>UTCTF 2019 - Scrambled</h1><div class="blog-subtext d-flex flex-wrap"><p class=blog-subtext-item><i class="fa fa-user"></i> Zander Work</p><p class=blog-subtext-item><i class="fa fa-folder"></i> Tags</p><p class=blog-subtext-item><i class="fa fa-calendar"></i> <time datetime=2019-03-11>Mar 11, 2019</time></p></div><img src=/blog/utctf-2019-scrambled.jpg alt class=blogcard-img><div class=blog-content-text><p><em>Tl;dr Cool encoding using Rubik’s cube, I wrote a <a href=https://github.com/zzzanderw/ctf-writeups/blob/master/utctf2019/scrambled/solve.py>Python script</a>.</em></p><p>This was a 1250 point Forensics challenge (highest points in the category). Here’s the description:</p><p><img src=/blog/utctf-2019-scrambled-challenge-description.png alt="Scrambled challenge description"></p><p>By the time I took a look at the challenge, they had released a hint as well:</p><p><img src=/blog/utctf-2019-scrambled-hint.png alt="Scrambled hint"></p><p>Based on the hint, I quickly discovered that the challenge description described ways of <a href=https://ruwix.com/the-rubiks-cube/notation/>manipulating a Rubik’s Cube</a>:</p><p><img src=/blog/utctf-2019-scrambled-rubiks-rotations.png alt="Rubik&amp;rsquo;s Cube face rotations"></p><p>Googling the hint (“rubikstega”) leads to a paper entitled “Rubikstega: A Novel Noiseless Steganography Method in Rubik’s Cube” (<a href=http://docplayer.net/99336533-Rubikstega-a-novel-noiseless-steganography-method-in-rubik-s-cube.html>link</a>). After skimming through the paper, it became clear that this was the method used to encode the message, so I got reading.</p><p>Here’s how the encoding works (at a high level, I’ll break it down more as I go through the challenge):</p><ul><li>Each message has 3+ “scrambles”.<ul><li>The first scramble provides a permutation value</li><li>The second provides the length of the message</li><li>The rest of the scrambles make up the message</li></ul></li><li>The encoding uses base 9 in order to encode messages. Since there are 18 possible moves, there are two moves for each base 9 value:</li></ul><p><img src=/blog/utctf-2019-scrambled-msg-encoding.png alt="From page 4 of the Rubikstega paper"></p><p>Let’s take a look at the first scramble. This will eventually yield a permutation value (P) that is used to mutate the default message encoding table for the rest of the scrambles.</p><pre tabindex=0><code>B2 R U F’ R’ L’ B B2 L F D D’ R’ F2 D’ R R D2 B’ L R

Scramble 1
</code></pre><p><img src=/blog/utctf-2019-scrambled-format1.png alt="Scramble 1 format (from page 5 of the Rubikstega paper)"></p><ol><li>First, we translate each move to a Base-9 value using the default encoding table. This gives us:<ul><li>512676150038748115801</li></ul></li><li>Then, we convert that Base-9 value to Base-10. This gives us:<ul><li>62553673461870258607</li></ul></li><li>Now we can extract the permutation value. The first digit (i) is 6, so we skip 6 more digits and then take the next 9. This gives us P:<ul><li>346187025</li></ul></li></ol><p>Now that we have the permutation value, we can modify the original encoding table for the rest of the scrambles:</p><p><img src=/blog/utctf-2019-scrambled-new-encoding.png alt="New message encoding table (based on P value from scramble 1)"></p><p>Now we can take a look at scramble 2. This will eventually yield the message length for the rest of the scrambles.</p><pre tabindex=0><code>L’ L B F2 R2 F2 R’ L F’ B’ R D’ D’ F U2 B’ U U D’ U2 F’

Scramble 2
</code></pre><p><img src=/blog/utctf-2019-scrambled-format2.png alt="Scramble 2 format (from page 6 of the Rubikstega paper)"></p><ol><li>First, we translate each move to Base-9 using the new encoding table that we created using P. This gives us:<ul><li>263101562434461477412</li></ul></li><li>Next, we convert that Base-9 value to Base-10. This gives us:<ul><li>32887738540626863753</li></ul></li><li>The first digit is j, and the second digit is k. Therefore:<ul><li>j = 3, and k = 2</li></ul></li><li>We get the start of the length by doing:<ul><li>2+j+1 = 2+3+1 = 6</li></ul></li><li>We get the end of the lengthy by doing:<ul><li>2+j+k = 2+3+2 = 7</li></ul></li><li>We take the Base-10 value as a string, and the numbers between indexes 6 and 7 are the length. Therefore:<ul><li>The message length is 73</li></ul></li></ol><p>Now we know we need to take 73 moves from the third scramble to decode our flag.</p><pre tabindex=0><code>L F’ F2 R B R R F2 F’ R2 D F’ U L U’ U’ U F D F2 U R U’ F U B2 B U2 D B F2 D2 L2 L2 B’ F’ D’ L2 D U2 U2 D2 U B’ F D R2 U2 R’ B’ F2 D’ D B’ U B’ D B’ F’ U’ R U U’ L’ L’ U2 F2 R R F L2 B2 L2 B B’ D R R’ U L

Scramble 3 (in it’s entirety, ~80 moves)
</code></pre><ol><li>First, we translate each move to Base-9 using the new encoding table again. This gives us:<ul><li>6213333120027655760173567831031877424701187460015414047404253752211336787</li></ul></li><li>Then, you convert that to binary (Base-2). This gives us:<ul><li>111010101110100011001100110110001100001011001110… (you get the point)</li></ul></li><li>Then you pad it with 0s at the beginning so you have equal blocks of 8. I won’t dump all that binary again, but you need one 0 at the beginning.</li><li>Then, you break it into blocks of 8 and convert to ASCII. This gives us the flag.</li></ol><p>At first I did this by hand, but I messed up somewhere and wasn’t able to get the proper ASCII values so I wrote a Python script, which you can see <a href=https://github.com/zzzanderw/ctf-writeups/blob/master/utctf2019/scrambled/solve.py>here</a>. Definitely wouldn’t recommend trying to do this by hand.</p><p>The flag is <strong>utflag{my_bra1n_1s_scrambl3d}</strong>.</p></div></div></div></main><footer class="border-top py-4 bg-light"><div class="text-muted text-center"><p>© 2024 OSU Security Club.</p><p>Contact us at: <a href=mailto:security.clubs@oregonstate.edu class="text-reset text-decoration-none fw-bold">security.clubs@oregonstate.edu</a></p></div></footer></body></html>