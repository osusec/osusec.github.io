<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js integrity=sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4 crossorigin=anonymous></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;600;800&family=Open+Sans:wght@400;600&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/solid.min.css integrity="sha512-LopA1sokwAW/FNZdP+/5q8MGyb9CojL1LTz8JMyu/8YZ8XaCDn1EOm6L7RWIIOHRM7K4jwnHuOmyLZeeeYxSOA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/caseyhates.css><title>0x41414141 CTF - 0x414141 | OSU Security Club</title></head><body id=background-img style=background-image:url(/blog/0x41414141-ctf-0x414141.jpg);background-position:50%><nav class="navbar navbar-expand-lg px-lg-5 py-lg-2 fixed-top topbar bg-light"><div class="container-fluid flex-nowrap px-lg-5"><a class=navbar-brand href=/><img src=/osusec-banner.png class=img-fluid alt=OSUSEC width=450px></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul><ul class="navbar-nav d-flex mb-2 mb-lg-0"><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/>Home</a></li><li class="nav-item px-1 dropdown"><a class="nav-link text-black dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>About</a><ul class=dropdown-menu><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/about/>Who We Are</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/club-constitution/>Club Constitution</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/wicys/>WiCyS</a></li></ul></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/calendar/>Calendar</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/blog/>Blog</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/ctf-league/>CTF League</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/accomplishments/>Accomplishments</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/resources/>Resources</a></li></ul></div></div></nav><main id=main><div id=home-jumbotron class="jumbotron text-center hero-content infopage-hero d-flex flex-column justify-content-center"><h1 class="hero-title py-1">0x41414141 CTF - 0x414141</h1></div><div class="bg-light justify-content-center infopage-content" style=min-height:60vh><div class=blog-content><h1 class=blog-title>0x41414141 CTF - 0x414141</h1><div class="blog-subtext d-flex flex-wrap"><p class=blog-subtext-item><i class="fa fa-user"></i> Lyell Read</p><p class=blog-subtext-item><i class="fa fa-folder"></i> Tags</p><p class=blog-subtext-item><i class="fa fa-calendar"></i> <time datetime=2021-02-02>Feb 2, 2021</time></p></div><img src=/blog/0x41414141-ctf-0x414141.jpg alt="0x41414141 CTF logo" class=blogcard-img><div class=blog-content-text><h2 id=prompt>Prompt</h2><p>I think offshift promised to opensource some of their code</p><p>author: notforsale</p><h2 id=solution>Solution</h2><p>First off, we navigate to the <a href=https://github.com/offshift-dev/assets/commits/master>offshift-dev</a> github account, linked from the offshift site. Unfortunately, nothing there. Searching google for “offshift github” brings us to a different github with a <a href=https://github.com/offshift-protocol/promo>single suspicious repository</a>. This has two commits, one where files are uploaded, and one in which the _<em>pycache</em>_ folder is deleted. That folder sounds interesting, so we clone the repository, and checkout the commit where the files were added:</p><pre tabindex=0><code>git clone git@github.com:offshift-protocol/promo.git
cd promo
git checkout dc43c1ac33f767a7d30dbeab123a1c87566e885d
cd __pycache__
</code></pre><p>There, we see one <code>.pyc</code> file, which is very likely where the interesting part of this challenge is. To understand it, we use uncompyle6:</p><pre tabindex=0><code>pip3 install uncompyle6 --user
uncompyle6 script.cpython-38.pyc &gt; ../../uncompyled.py
</code></pre><p>Now, upon reviewing that file, we see that we have some interesting cipher of sorts that uses XOR and base64 somehow:</p><pre tabindex=0><code>import base64
secret = &#39;https://google.com&#39;
cipher2 = [b&#39;NDE=&#39;, b&#39;NTM=&#39;, b&#39;NTM=&#39;, b&#39;NDk=&#39;, b&#39;NTA=&#39;, b&#39;MTIz&#39;, b&#39;MTEw&#39;, b&#39;MTEw&#39;, b&#39;MzI=&#39;, b&#39;NTE=&#39;, b&#39;MzQ=&#39;, b&#39;NDE=&#39;, b&#39;NDA=&#39;, b&#39;NTU=&#39;, b&#39;MzY=&#39;, b&#39;MTEx&#39;, b&#39;NDA=&#39;, b&#39;NTA=&#39;, b&#39;MTEw&#39;, b&#39;NDY=&#39;, b&#39;MTI=&#39;, b&#39;NDU=&#39;, b&#39;MTE2&#39;, b&#39;MTIw&#39;]
cipher1 = [base64.b64encode(str(ord(i) ^ 65).encode()) for i in secret]
</code></pre><p>From a little deduction, we can guess that the creation of <code>cipher1</code> based on <code>secret</code> is how the list <code>cipher2</code> was developed. Therefore, to decipher that array, we simply need to reverse the list comprehension that generates <code>cipher1</code>.</p><p>Working from the outside to the inside (to reverse the operations done during enciphering), we will need to first base64 decode each element. Then, we will have to cast it to an int (the output of <code>ord()</code>), and then use <code>chr()</code> to undo the <code>ord()</code> operation. Lastly we must undo the XOR with 65, which can be done by simply XORing it again. This can all be accomplished as so:</p><pre tabindex=0><code>print(&#39;&#39;.join([chr(int(base64.b64decode(x)) ^ 65) for x in cipher2]))
</code></pre><p>From that, we get a URL: <a href=https://archive.is/oMl59>https://archive.is/oMl59</a>. That archive is a post on 4chan’s /x/ board where the original poster included a link to a <a href=https://mega.nz/file/AAdDyIoB#gpj5s9N9-VnbNhSdkJ24Yyq3BWSYimoxanP-p03gQWs>mega.nz file download</a>. This downloads what appears to be a corrupt “PDF” [file called smashing.pdf], which <code>file</code> identifies as “data”, indicating that there are no identifiable magic bytes.</p><blockquote><p>NOTE: At this point, inference is made that this PDF is encrypted with a repeating key that makes use of the magic bytes to reverse.</p></blockquote><p>From Wikipedia, we can see that a PDF file should start with <code>25 50 44 46 2d</code>, so we perform an XOR to determine what the key that was used to encrypt this PDF was.</p><pre tabindex=0><code>  25 50 44 46 2d -- PDF Magic Bytes
^ 64 11 05 07 6c -- Start of smashing.pdf
----------------
= 41 41 41 41 41 -- key used to encrypt
</code></pre><p>I would not expect anything less. Therefore, we need to decrypt the whole PDF using this key, and for that, we can use a python script like this one:</p><pre tabindex=0><code>with open(&#34;smashing.pdf&#34;, &#34;rb&#34;) as f:
    contents = f.read()

key = b&#34;\x41\x41\x41\x41&#34;
out = b&#34;&#34;
for i in range(len(contents)):
    out += bytes([contents[i] ^ key[i % len(key)]])

with open(&#34;done_xor.pdf&#34;, &#34;wb&#34;) as f:
    f.write(out)
</code></pre><pre tabindex=0><code>file done_xor.pdf
done_xor.pdf: PDF document, version 1.4
</code></pre><p>That’s much better, but there’s more. When running <code>strings</code> on that file, we see references to <code>flag.txt</code>, so this could be real steganography. To find out, we use <code>foremost</code>:</p><pre tabindex=0><code>dd if=done_xor.pdf | foremost
Processing: stdin
|360+1 records in
360+1 records out
184539 bytes (185 kB, 180 KiB) copied, 0.0017788 s, 104 MB/s
foundat=flag.txtUT
*|
</code></pre><p>Interesting, so we appear to have recovered something. Looking through <code>foremost</code>‘s <a href=https://github.com/lyellread/ctf-writeups/blob/master/2021-0x41414141/0x414141/output>output folder</a>, we can see that it sliced a PDF and a Zip archive. Next, we have to unzip that, presumably. Let’s give that a shot:</p><pre tabindex=0><code>unzip foremost.zip
Archive:  foremost.zip
[foremost.zip] flag.txt password: 
</code></pre><p>We need a password, and because we do not know it, we are going to have to crack it. To do so, we must build John The Ripper from source (to have access to <code>zip2john</code>). For that, I followed <a href=https://hackthestuff.com/article/how-to-install-john-the-ripper-in-linux-and-crack-password>this handy guide</a>. Once installed, it’s as easy as:</p><pre tabindex=0><code>zip2john foremost.zip &gt; hashes
john hashes --show
foremost/flag.txt:passwd:flag.txt:foremost::foremost
1 password hash cracked, 0 left
</code></pre><p>Armed with our password <code>passwd</code>, we attack the Zip, and get the flag:</p><pre tabindex=0><code>flag{1t_b33n_A_l0ng_w@y8742}
</code></pre><p>~ Lyell</p></div></div></div></main><footer class="border-top py-4 bg-light"><div class="text-muted text-center"><p>© <script>document.write((new Date).getFullYear())</script>&nbsp;OSU Security Club.</p><p>Contact us at:
<a href=mailto:security.clubs@oregonstate.edu class="text-reset text-decoration-none fw-bold">security.clubs@oregonstate.edu</a></p><div class=mt-3><div class="d-flex justify-content-center gap-3"><a href=https://www.instagram.com/dam.secure/ target=_blank class=text-reset title=Instagram><i class="fab fa-instagram" aria-hidden=true></i></a>
<a href=https://x.com/OSUSEC target=_blank class=text-reset title=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></div></div></div></footer></body></html>