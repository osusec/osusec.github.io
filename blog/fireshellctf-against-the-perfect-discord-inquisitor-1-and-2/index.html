<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65 crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js integrity=sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4 crossorigin=anonymous></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;600;800&family=Open+Sans:wght@400;600&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css integrity="sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/solid.min.css integrity="sha512-LopA1sokwAW/FNZdP+/5q8MGyb9CojL1LTz8JMyu/8YZ8XaCDn1EOm6L7RWIIOHRM7K4jwnHuOmyLZeeeYxSOA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/caseyhates.css><title>FireshellCTF Against the Perfect discord Inquisitor 1 and 2 | OSU Security Club</title></head><body id=background-img style=background-image:url(/blog/fireshellctf-against-the-perfect-discord-inquisitor-1-and-2.jpg);background-position:50%><nav class="navbar navbar-expand-lg px-lg-5 py-lg-2 fixed-top topbar bg-light"><div class="container-fluid flex-nowrap px-lg-5"><a class=navbar-brand href=/><img src=/osusec-banner.png class=img-fluid alt=OSUSEC width=450px></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul><ul class="navbar-nav d-flex mb-2 mb-lg-0"><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/>Home</a></li><li class="nav-item px-1 dropdown"><a class="nav-link text-black dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>About</a><ul class=dropdown-menu><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/about/>Who We Are</a></li><li><a class="dropdown-item topbar topbar-drop shadow-none" href=/club-constitution/>Club Constitution</a></li></ul></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/calendar/>Calendar</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/blog/>Blog</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/ctf-league/>CTF League</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/accomplishments/>Accomplishments</a></li><li class="nav-item px-1"><a class="nav-link highlight-orange-nav" href=/resources/>Resources</a></li></ul></div></div></nav><main id=main><div id=home-jumbotron class="jumbotron text-center hero-content infopage-hero d-flex flex-column justify-content-center"><h1 class="hero-title py-1">FireshellCTF Against the Perfect discord Inquisitor 1 and 2</h1></div><div class="bg-light justify-content-center infopage-content" style=min-height:60vh><div class=blog-content><h1 class=blog-title>FireshellCTF Against the Perfect discord Inquisitor 1 and 2</h1><div class="blog-subtext d-flex flex-wrap"><p class=blog-subtext-item><i class="fa fa-user"></i> Lyell Read</p><p class=blog-subtext-item><i class="fa fa-folder"></i> Tags</p><p class=blog-subtext-item><i class="fa fa-calendar"></i> <time datetime=2020-03-29>Mar 29, 2020</time></p></div><img src=/blog/fireshellctf-against-the-perfect-discord-inquisitor-1-and-2.jpg alt="The Fireshell Security Team's banner, featuring their website URL" class=blogcard-img><div class=blog-content-text><h2 id=prompt-1>Prompt 1</h2><p>You’re on a journey and come to the Tavern of a Kingdom Enemy, you need to get information of a secret organization for the next quest. Be careful about the Inquisitor! He can ban you from this world.</p><p>TL;DR find the flag</p><p><a href=https://discord.gg/fHHyU6g>Kingdom Chall</a></p><p>HINT: Title/Chall name</p><h2 id=prompt-2>Prompt 2</h2><p>There is a mage in the tavern that reveals secrets from the place. He is friendly, so he can help you! Be careful about the Inquisitor! He can ban you from this world.</p><p>TL;DR use the bot to get the flag</p><p><a href=https://discord.gg/fHHyU6g>Kingdom Chall</a></p><h2 id=solution-1>Solution 1</h2><p>Starting out, we clicked the link to <a href=https://discord.gg/fHHyU6g>Kingdom Chall</a>, and joined the discord. There, we identified a long stream of other people joining, as well as a bot account named <code>Gandalf</code>. <code>Gandalf</code>‘s status reads:</p><pre tabindex=0><code>You’re welcome~ Free reveals with command: $reveal_secret (channel.id) (message.id)
</code></pre><p>Obviously, we need to test this:</p><pre tabindex=0><code>lyellread
$reveal_secret 688190172793536545 691089964401819759
Gandalf [BOT]
@everyone say hello to @Gandalf !
</code></pre><p>Great! Looks like <code>Gandalf</code> will be our oracle for any messages that we have ID’s for but cannot read ourselves. What’s next?</p><p>Someone had a plugin enabled that saw there was a hidden channel on the Discord, with ID <code>688190289814618213</code>, with name <code>hidden-round-table</code>. We would have found this in our API search below, but this helped refine where we were headed wiht <code>Gandalf</code> and the API.</p><p>Now onto that hint: The challenge name is “Against the Perfect discord Inquisitor” – that makes acronym “API”… I know where this is going. We need to make some API request to get some information.</p><p>After quite a bit of looking (Discord, your docs suck big time!!), we came up with <a href=https://github.com/lyellread/ctf-writeups/blob/master/2020-fireshell/discord-1-and-2/discord_bot.py>this script</a> which will make a <code>GET</code> request to the API. We needed a token, too, and thankfully, GitHub user Tyrrrz provides <a href=https://github.com/Tyrrrz/DiscordChatExporter/wiki/Obtaining-Token-and-Channel-IDs>this guide</a> to getting tokens and channel (and message and guild) ID’s. Now we can work with that. We tried:</p><ul><li><code>/api/v6/channel/688190172793536545/messages</code>: returns all the messages – nothing new, as we can read all messages in that channel.</li><li><code>/api/v6/channel/688190289814618213/messages</code>: returns not authorized to view messages in hidden channel – no suprise there.</li><li><code>/api/v6/guilds/688190172793536536</code>: returns much of what we already knew about this guild</li><li><code>/api/v6/guilds/688190172793536536/channels</code>:</li></ul><pre tabindex=0><code>[{&#34;id&#34;: &#34;688190172793536539&#34;, &#34;type&#34;: 4, &#34;name&#34;: &#34;Kingdom&#34;, &#34;position&#34;: 0, &#34;parent_id&#34;: null, &#34;guild_id&#34;: &#34;688190172793536536&#34;, &#34;permission_overwrites&#34;: [], &#34;nsfw&#34;: false}, {&#34;id&#34;: &#34;688190172793536545&#34;, &#34;last_message_id&#34;: &#34;691368465201758319&#34;, &#34;type&#34;: 0, &#34;name&#34;: &#34;tavern&#34;, &#34;position&#34;: 0, &#34;parent_id&#34;: &#34;688190172793536539&#34;, &#34;topic&#34;: &#34;A place of business where people gather to drink alcoholic beverages and be served food, and in most cases, where travelers receive lodging.&#34;, &#34;guild_id&#34;: &#34;688190172793536536&#34;, &#34;permission_overwrites&#34;: [{&#34;id&#34;: &#34;688190172793536536&#34;, &#34;type&#34;: &#34;role&#34;, &#34;allow&#34;: 0, &#34;deny&#34;: 2048}], &#34;nsfw&#34;: false, &#34;rate_limit_per_user&#34;: 0}, 

{&#34;id&#34;: &#34;688190289814618213&#34;, &#34;last_message_id&#34;: &#34;688214063595258088&#34;, &#34;type&#34;: 0, &#34;name&#34;: &#34;hidden-round-table&#34;, &#34;position&#34;: 1, &#34;parent_id&#34;: &#34;688190172793536539&#34;, &#34;topic&#34;: &#34;F#{The_Table_of_King_Arthur}&#34;, &#34;guild_id&#34;: &#34;688190172793536536&#34;, &#34;permission_overwrites&#34;: [{&#34;id&#34;: &#34;688190172793536536&#34;, &#34;type&#34;: &#34;role&#34;, &#34;allow&#34;: 0, &#34;deny&#34;: 3072}, {&#34;id&#34;: &#34;688190424124227590&#34;, &#34;type&#34;: &#34;role&#34;, &#34;allow&#34;: 3072, &#34;deny&#34;: 0}], &#34;nsfw&#34;: false, &#34;rate_limit_per_user&#34;: 0}]
</code></pre><p>That’s the first flag! <code>F#{The_Table_of_King_Arthur}</code> – the description of <code>#hidden_round_table</code>! Now onto the next one…</p><h2 id=solution-2>Solution 2</h2><p>We have not even used <code>Gandalf</code> yet, so we will need to. The output above tells us something interesting (and exactly what we need to use <code>Gandalf</code>) – the last message id in <code>#hidden_round_table</code>: <code>688214063595258088</code>. Now we can ask our “Mage” <code>Gandalf</code> about this:</p><pre tabindex=0><code>lyellread
$reveal_secret 688190289814618213 688214063595258088
Gandalf [BOT] 
RiN7UzRiM1JfMTVfVGgzX0sxbmdfQXJ0aHVyfQ==
</code></pre><p>That looks like base64… One sec, <a href=https://www.base64decode.org/>we can fix that</a>, and we get <code>F#{S4b3R_15_Th3_K1ng_Arthur}</code>!</p><p>Thank you Fireshell Team and @K4L1!!</p><p>~Lyell Read, Phillip Mestas, Robert Detjens</p></div></div></div></main><footer class="border-top py-4 bg-light"><div class="text-muted text-center"><p>© 2023 OSU Security Club.</p><p>Contact us at: <a href=mailto:security.clubs@oregonstate.edu class="text-reset text-decoration-none fw-bold">security.clubs@oregonstate.edu</a></p></div></footer></body></html>